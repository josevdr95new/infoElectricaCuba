<html><head><base href="https://www.ai-interactions.com">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Info Eléctrica Cuba - Análisis IA Mejorado</title>
<style>
  :root {
    --primary-color: #1565C0;
    --secondary-color: #2196F3;
    --background-color: #E3F2FD;
    --text-color: #212121;
    --card-background: #FFFFFF;
    --accent-color: #FFC107;
    --error-color: #F44336;
    --success-color: #4CAF50;
  }

  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }

  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen-Sans, Ubuntu, Cantarell, 'Helvetica Neue', sans-serif;
    background-color: var(--background-color);
    color: var(--text-color);
    line-height: 1.6;
  }

  .app-container {
    max-width: 100%;
    margin: 0 auto;
    padding-bottom: 70px;
  }

  .header {
    background-color: var(--primary-color);
    color: white;
    text-align: center;
    padding: 20px;
    position: sticky;
    top: 0;
    z-index: 1000;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }

  .header h1 {
    font-size: 1.5rem;
    margin-bottom: 5px;
  }

  .content {
    padding: 20px;
  }

  .card {
    background-color: var(--card-background);
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    padding: 20px;
    margin-bottom: 20px;
  }

  .card h2 {
    color: var(--primary-color);
    margin-bottom: 15px;
    font-size: 1.2rem;
    display: flex;
    align-items: center;
  }

  .card h2 i {
    margin-right: 10px;
  }

  #message, .history-item {
    background-color: var(--card-background);
    border-left: 4px solid var(--secondary-color);
    padding: 15px;
    margin-top: 15px;
    font-size: 1rem;
    line-height: 1.5;
    color: var(--text-color);
    border-radius: 4px;
  }

  #message a, .history-item a {
    color: var(--secondary-color);
    text-decoration: none;
  }

  #message a:hover, .history-item a:hover {
    text-decoration: underline;
  }

  #datetime, .history-date {
    color: var(--accent-color);
    font-size: 0.9rem;
    font-weight: bold;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
  }

  #datetime i, .history-date i {
    margin-right: 5px;
  }

  #history {
    display: none;
  }

  .menu {
    display: flex;
    justify-content: space-around;
    background-color: var(--primary-color);
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 10px 0;
    box-shadow: 0 -2px 4px rgba(0,0,0,0.1);
  }

  .menu-item {
    text-align: center;
    color: white;
    text-decoration: none;
    font-size: 0.8rem;
    transition: color 0.3s ease;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .menu-item:hover {
    color: var(--accent-color);
  }

  .menu-item i {
    font-size: 1.5rem;
    margin-bottom: 5px;
  }

  .disclaimer {
    font-size: 0.8rem;
    color: #757575;
    text-align: center;
    padding: 15px;
    background-color: var(--card-background);
    margin-top: 30px;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
  }

  .disclaimer .version-info {
    font-weight: bold;
    color: var(--primary-color);
    margin-bottom: 10px;
  }

  .disclaimer .legal-text {
    font-style: italic;
  }

  .loading {
    text-align: center;
    color: var(--secondary-color);
  }

  .error {
    color: var(--error-color);
    text-align: center;
  }

  #provinceSelector {
    width: 100%;
    padding: 12px;
    margin-bottom: 15px;
    border: 1px solid var(--secondary-color);
    border-radius: 4px;
    background-color: var(--card-background);
    font-size: 1rem;
    color: var(--text-color);
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    background-image: url('data:image/svg+xml;utf8,<svg fill="%231565C0" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/><path d="M0 0h24v24H0z" fill="none"/></svg>');
    background-repeat: no-repeat;
    background-position: right 10px center;
  }

  #imageContainer img {
    max-width: 100%;
    height: auto;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }

  #imageDescription {
    margin-top: 10px;
    font-style: italic;
    color: var(--text-color);
  }

  .donation-section {
    background-color: var(--secondary-color);
    border-radius: 8px;
    padding: 20px;
    margin-top: 20px;
    text-align: center;
    color: white;
  }

  .donation-section h3 {
    color: white;
    margin-bottom: 10px;
  }

  .donation-number {
    font-size: 1.2rem;
    font-weight: bold;
    color: white;
    background-color: var(--primary-color);
    padding: 5px 10px;
    border-radius: 4px;
    display: inline-block;
    margin-top: 10px;
  }

  #notificationToggle {
    background-color: var(--accent-color);
    color: var(--text-color);
    border: none;
    padding: 10px 15px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 1rem;
    margin-top: 10px;
    transition: background-color 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  #notificationToggle i {
    margin-right: 5px;
  }

  #notificationToggle:hover {
    background-color: #FFD54F;
  }

  #notificationStatus {
    margin-top: 10px;
    font-style: italic;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  #notificationStatus i {
    margin-right: 5px;
  }

  #aiAnalysis {
    background-color: var(--card-background);
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    padding: 20px;
    margin-top: 20px;
  }

  #aiAnalysis h2 {
    color: var(--primary-color);
    margin-bottom: 15px;
    font-size: 1.2rem;
    display: flex;
    align-items: center;
  }

  #aiAnalysis h2 i {
    margin-right: 10px;
  }

  #aiAnalysisContent {
    background-color: #F5F5F5;
    border-left: 4px solid var(--accent-color);
    padding: 15px;
    font-size: 1rem;
    line-height: 1.5;
    color: var(--text-color);
    border-radius: 4px;
  }

  .affection-level {
    font-weight: bold;
    margin-top: 10px;
  }

  .affection-level.high {
    color: var(--error-color);
  }

  .affection-level.medium {
    color: var(--accent-color);
  }

  .affection-level.low {
    color: var(--success-color);
  }

  @media (min-width: 768px) {
    .app-container {
      max-width: 768px;
    }
  }
</style>
<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
  <div class="app-container">
    <header class="header">
      <h1><i class="fas fa-bolt"></i> Info Eléctrica Cuba</h1>
      <p>Última actualización del servicio</p>
    </header>

    <div class="content">
      <div class="card" id="selector-card">
        <h2><i class="fas fa-map-marker-alt"></i> Selecciona una provincia</h2>
        <select id="provinceSelector">
          <option value="">Selecciona una provincia</option>
          <option value="https://t.me/s/une_cuba">UNE CUBA</option>
          <option value="https://t.me/s/elecpinar">Pinar del Río</option>
          <option value="https://t.me/s/EEArtemisa">Artemisa</option>
          <option value="https://t.me/s/ceelh">La Habana</option>
          <option value="https://t.me/s/electricamayabeque">Mayabeque</option>
          <option value="https://t.me/s/EmpresaElectricaMatanzas">Matanzas</option>
          <option value="https://t.me/s/empresaelectricacienfuegos1">Cienfuegos</option>
          <option value="https://t.me/s/electrico1895">Villa Clara</option>
          <option value="https://t.me/s/informateessp">Sancti Spíritus</option>
          <option value="https://t.me/s/eecav">Ciego de Ávila</option>
          <option value="https://t.me/s/empresa_electrica">Camagüey</option>
          <option value="https://t.me/s/eleclastunas">Las Tunas</option>
          <option value="https://t.me/s/elecholguin">Holguín</option>
          <option value="https://t.me/s/UNE_EEG">Granma</option>
          <option value="https://t.me/s/electricastgo">Santiago de Cuba</option>
          <option value="https://t.me/s/elecguantanamo">Guantánamo</option>
        </select>
        <button id="notificationToggle"><i class="fas fa-bell"></i> Activar notificaciones</button>
        <p id="notificationStatus"><i class="fas fa-info-circle"></i> Estado de notificaciones</p>
      </div>

      <div id="latest-news" class="card">
        <h2><i class="fas fa-newspaper"></i> Última Noticia</h2>
        <div id="datetime"><i class="far fa-clock"></i> <span></span></div>
        <div id="message" class="loading">Cargando último mensaje...</div>
      </div>

      <div id="imageSection" class="card" style="display:none;">
        <h2><i class="far fa-image"></i> Imagen del mensaje</h2>
        <div id="imageContainer"></div>
        <p id="imageDescription"></p>
      </div>

      <div id="history" class="card">
        <h2><i class="fas fa-history"></i> Publicaciones</h2>
        <div id="historyContent" class="loading">Cargando publicaciones...</div>
      </div>

      <div id="aiAnalysis" class="card">
        <h2><i class="fas fa-brain"></i> Análisis de IA</h2>
        <div id="aiAnalysisContent" class="loading">Esperando datos para analizar...</div>
      </div>

      <div id="about" class="card">
        <h2><i class="fas fa-info-circle"></i> Sobre la App</h2>
        <p>Esta aplicación proporciona información actualizada sobre el servicio eléctrico en las diferentes provincias de Cuba. Los datos se obtienen de fuentes públicas y se actualizan periódicamente.</p>
      </div>

      <div class="donation-section">
        <h3><i class="fas fa-hand-holding-heart"></i> Apoya nuestro trabajo</h3>
        <p>Si encuentras útil esta aplicación, considera hacer una donación para mantenerla actualizada y mejorarla.</p>
        <p>Número para donaciones: <span class="donation-number"><i class="fas fa-phone"></i> 123456789</span></p>
      </div>
    </div>

    <div class="disclaimer">
      <p class="version-info"><i class="fas fa-code-branch"></i> Versión 1.19 | Autor: josevdr95</p>
      <p class="legal-text"><i class="fas fa-exclamation-triangle"></i> Descargo de responsabilidad: Esta aplicación no está afiliada ni tiene relación oficial con las Empresas Eléctricas de Cuba. La información proporcionada se obtiene de fuentes públicas y puede no estar actualizada o ser precisa en todo momento. El uso de esta aplicación es bajo su propia responsabilidad.</p>
    </div>

    <nav class="menu">
      <a href="#latest-news" class="menu-item" id="latestNewsMenu">
        <i class="fas fa-bolt"></i>
        Última Noticia
      </a>
      <a href="#history" id="historyMenu" class="menu-item">
        <i class="fas fa-history"></i>
        Mostrar publicaciones
      </a>
      <a href="#about" class="menu-item" id="aboutMenu">
        <i class="fas fa-info-circle"></i>
        Sobre la App
      </a>
    </nav>
  </div>

  <script>
    let currentUrl = localStorage.getItem('lastSelectedUrl') || 'https://t.me/s/une_cuba';
    let lastMessageId = localStorage.getItem('lastMessageId') || '';
    let notificationsEnabled = JSON.parse(localStorage.getItem('notificationsEnabled')) || false;
    let checkInterval;

    const messageElement = document.getElementById('message');
    const datetimeElement = document.getElementById('datetime').querySelector('span');
    const imageSection = document.getElementById('imageSection');
    const imageContainer = document.getElementById('imageContainer');
    const imageDescription = document.getElementById('imageDescription');
    const historyContent = document.getElementById('historyContent');
    const provinceSelector = document.getElementById('provinceSelector');
    const notificationToggle = document.getElementById('notificationToggle');
    const notificationStatus = document.getElementById('notificationStatus');
    const aiAnalysisContent = document.getElementById('aiAnalysisContent');

    async function fetchMessages(url) {
      try {
        const response = await fetch('https://api.allorigins.win/get?url=' + encodeURIComponent(url));
        const data = await response.json();
        const parser = new DOMParser();
        const doc = parser.parseFromString(data.contents, 'text/html');
        return Array.from(doc.querySelectorAll('.tgme_widget_message'));
      } catch (error) {
        console.error('Error al obtener los mensajes:', error);
        return [];
      }
    }

    async function displayLatestMessage() {
      messageElement.classList.add('loading');
      messageElement.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Cargando el último mensaje...';
      datetimeElement.textContent = '';
      imageSection.style.display = 'none';
      imageContainer.innerHTML = '';
      imageDescription.textContent = '';
      
      const messages = await fetchMessages(currentUrl);
      
      if (messages.length > 0) {
        const latestMessage = messages[messages.length - 1];
        const messageId = latestMessage.getAttribute('data-post');
        const messageTextElement = latestMessage.querySelector('.tgme_widget_message_text');
        const messageTimeElement = latestMessage.querySelector('.tgme_widget_message_date time');
        const messageImage = latestMessage.querySelector('.tgme_widget_message_photo_wrap');
        
        if (messageId !== lastMessageId) {
          lastMessageId = messageId;
          localStorage.setItem('lastMessageId', lastMessageId);
          if (notificationsEnabled) {
            notifyNewMessage();
          }
        }
        
        if (messageTimeElement) {
          const messageTime = messageTimeElement.getAttribute('datetime');
          const formattedDate = new Date(messageTime).toLocaleString('es-ES', { timeZone: 'America/Havana', day: 'numeric', month: 'long', year: 'numeric', hour: '2-digit', minute: '2-digit' });
          datetimeElement.textContent = `Publicado el ${formattedDate}`;
        }
        
        if (messageImage) {
          const imageStyle = messageImage.getAttribute('style');
          const imageUrlMatch = imageStyle.match(/url\('(.+)'\)/);
          if (imageUrlMatch && imageUrlMatch[1]) {
            const imageUrl = imageUrlMatch[1];
            imageContainer.innerHTML = `<img src="${imageUrl}" alt="Imagen del mensaje" loading="lazy">`;
            imageSection.style.display = 'block';
            
            const imageAlt = messageImage.querySelector('img')?.getAttribute('alt') || 'Imagen del mensaje';
            imageDescription.textContent = `Descripción: ${imageAlt}`;
          }
        }
        
        if (messageTextElement) {
          messageElement.innerHTML = messageTextElement.innerHTML;
          messageElement.classList.remove('loading');
        } else if (messageImage) {
          messageElement.innerHTML = '<i class="far fa-image"></i> El último mensaje contiene una imagen.';
          messageElement.classList.remove('loading');
        } else {
          messageElement.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Error al cargar el mensaje.';
          messageElement.classList.remove('loading');
          messageElement.classList.add('error');
        }
      } else {
        messageElement.innerHTML = '<i class="fas fa-exclamation-circle"></i> No se encontraron mensajes.';
        messageElement.classList.remove('loading');
        messageElement.classList.add('error');
      }
    }

    async function displayMessageHistory() {
      historyContent.classList.add('loading');
      historyContent.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Cargando publicaciones...';
      
      const messages = await fetchMessages(currentUrl);
      
      if (messages.length > 0) {
        historyContent.innerHTML = '';
        historyContent.classList.remove('loading');
        
        const messagesToAnalyze = [];
        
        messages.slice(-10).reverse().forEach((message) => {
          const messageTextElement = message.querySelector('.tgme_widget_message_text');
          const messageTimeElement = message.querySelector('.tgme_widget_message_date time');
          const messageImage = message.querySelector('.tgme_widget_message_photo_wrap');
          
          const historyItem = document.createElement('div');
          historyItem.className = 'history-item';
          
          if (messageTimeElement) {
            const messageTime = messageTimeElement.getAttribute('datetime');
            const formattedDate = new Date(messageTime).toLocaleString('es-ES', { timeZone: 'America/Havana', day: 'numeric', month: 'long', year: 'numeric', hour: '2-digit', minute: '2-digit' });
            historyItem.innerHTML += `<div class="history-date"><i class="far fa-clock"></i> Publicado el ${formattedDate}</div>`;
          }
          
          if (messageImage) {
            const imageStyle = messageImage.getAttribute('style');
            const imageUrlMatch = imageStyle.match(/url\('(.+)'\)/);
            if (imageUrlMatch && imageUrlMatch[1]) {
              const imageUrl = imageUrlMatch[1];
              historyItem.innerHTML += `<img src="${imageUrl}" alt="Imagen del mensaje" loading="lazy" style="max-width: 100%; height: auto; margin-top: 10px;">`;
              
              const imageAlt = messageImage.querySelector('img')?.getAttribute('alt') || 'Imagen del mensaje';
              historyItem.innerHTML += `<p><i class="far fa-image"></i> Descripción: ${imageAlt}</p>`;
            }
          }
          
          if (messageTextElement) {
            historyItem.innerHTML += `<div>${messageTextElement.innerHTML}</div>`;
            messagesToAnalyze.push(messageTextElement.textContent);
          }
          
          historyContent.appendChild(historyItem);
        });
        
        analyzeMessages(messagesToAnalyze);
      } else {
        historyContent.innerHTML = '<i class="fas fa-exclamation-circle"></i> No se encontraron publicaciones.';
        historyContent.classList.remove('loading');
        historyContent.classList.add('error');
      }
    }

    function analyzeMessages(messages) {
      aiAnalysisContent.classList.add('loading');
      aiAnalysisContent.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Analizando datos...';

      setTimeout(() => {
        const keywordsHigh = ['apagón', 'interrupción', 'grave', 'urgente', 'emergencia'];
        const keywordsMedium = ['mantenimiento', 'reparación', 'avería', 'falla'];
        const keywordsLow = ['actualización', 'mejora', 'normalizado', 'estable'];

        let highCount = 0;
        let mediumCount = 0;
        let lowCount = 0;

        messages.forEach(message => {
          const lowercaseMessage = message.toLowerCase();
          if (keywordsHigh.some(keyword => lowercaseMessage.includes(keyword))) {
            highCount++;
          } else if (keywordsMedium.some(keyword => lowercaseMessage.includes(keyword))) {
            mediumCount++;
          } else if (keywordsLow.some(keyword => lowercaseMessage.includes(keyword))) {
            lowCount++;
          }
        });

        let overallAffectionLevel;
        let analysis = 'Basado en el análisis de los últimos mensajes: ';

        if (highCount > mediumCount && highCount > lowCount) {
          overallAffectionLevel = 'alto';
          analysis += 'Se detecta una situación general de alta afectación en el servicio eléctrico. ';
        } else if (mediumCount > highCount && mediumCount > lowCount) {
          overallAffectionLevel = 'medio';
          analysis += 'Se identifica una afectación moderada en el servicio eléctrico. ';
        } else {
          overallAffectionLevel = 'bajo';
          analysis += 'Parece haber una situación de baja afectación o normalidad en el servicio eléctrico. ';
        }

        analysis += `Se encontraron ${highCount} menciones de alta gravedad, ${mediumCount} de gravedad media, y ${lowCount} de baja gravedad o normalidad. `;
        analysis += 'Se recomienda estar atento a futuras actualizaciones y seguir las indicaciones oficiales.';

        aiAnalysisContent.innerHTML = `
          ${analysis}
          <div class="affection-level ${overallAffectionLevel}">Nivel general de afectación: ${overallAffectionLevel.toUpperCase()}</div>
        `;
        aiAnalysisContent.classList.remove('loading');
      }, 1500);
    }

    function toggleSection(sectionId) {
      const section = document.getElementById(sectionId);
      if (section.style.display === 'none' || section.style.display === '') {
        section.style.display = 'block';
        if (sectionId === 'history') {
          displayMessageHistory();
        }
      } else {
        section.style.display = 'none';
      }
    }

    function notifyNewMessage() {
      if ("Notification" in window) {
        if (Notification.permission === "granted") {
          new Notification("Nuevo mensaje eléctrico", {
            body: "Hay un nuevo mensaje disponible. Toca para verlo.",
            icon: "https://example.com/icon.png"
          });
        } else if (Notification.permission !== "denied") {
          Notification.requestPermission().then(function (permission) {
            if (permission === "granted") {
              new Notification("Nuevo mensaje eléctrico", {
                body: "Hay un nuevo mensaje disponible. Toca para verlo.",
                icon: "https://example.com/icon.png"
              });
            }
          });
        }
      }
    }

    function toggleNotifications() {
      notificationsEnabled = !notificationsEnabled;
      localStorage.setItem('notificationsEnabled', JSON.stringify(notificationsEnabled));
      updateNotificationStatus();
      
      if (notificationsEnabled) {
        startCheckingForNewMessages();
      } else {
        stopCheckingForNewMessages();
      }
    }

    function updateNotificationStatus() {
      if (notificationsEnabled) {
        notificationToggle.innerHTML = '<i class="fas fa-bell-slash"></i> Desactivar notificaciones';
        notificationStatus.innerHTML = '<i class="fas fa-check-circle"></i> Las notificaciones están activadas.';
      } else {
        notificationToggle.innerHTML = '<i class="fas fa-bell"></i> Activar notificaciones';
        notificationStatus.innerHTML = '<i class="fas fa-times-circle"></i> Las notificaciones están desactivadas.';
      }
    }

    function startCheckingForNewMessages() {
      checkInterval = setInterval(displayLatestMessage, 300000);
    }

    function stopCheckingForNewMessages() {
      clearInterval(checkInterval);
    }

    function scrollToSection(sectionId) {
      const section = document.getElementById(sectionId);
      if (section) {
        section.scrollIntoView({ behavior: 'smooth' });
      }
    }

    provinceSelector.addEventListener('change', function() {
      currentUrl = this.value;
      localStorage.setItem('lastSelectedUrl', currentUrl);
      displayLatestMessage();
      if (document.getElementById('history').style.display !== 'none') {
        displayMessageHistory();
      }
      scrollToSection('latest-news');
    });

    document.getElementById('latestNewsMenu').addEventListener('click', function(e) {
      e.preventDefault();
      displayLatestMessage();
      scrollToSection('latest-news');
    });

    document.getElementById('historyMenu').addEventListener('click', function(e) {
      e.preventDefault();
      toggleSection('history');
      displayMessageHistory();
      scrollToSection('history');
    });

    document.getElementById('aboutMenu').addEventListener('click', function(e) {
      e.preventDefault();
      scrollToSection('about');
    });

    notificationToggle.addEventListener('click', toggleNotifications);

    window.addEventListener('load', () => {
      provinceSelector.value = currentUrl;
      displayLatestMessage();
      updateNotificationStatus();
      if (notificationsEnabled) {
        startCheckingForNewMessages();
      }
    });
  </script>
</body>
</html>